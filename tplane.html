<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:700" rel="stylesheet">
    <style>
        *{
            font-family: 'Open Sans Condensed', sans-serif;
        }
    </style>
    <script>
        var ctx, canvas;
        var w = h = 1024;
        var time = 0;
        window.onload = function () {



            canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;
            document.body.appendChild(canvas);
            ctx = canvas.getContext("2d");
            ctx.strokeStyle = 'white';
            
            ctx.fillRect(0, 0, w, h);
            ctx.fillStyle = 'white';
            plane.init();

            animate();
        }

        var plane = {
            string: ["CAN'T", "BELIEVE", "THE WAY", "WE FLOW"],
            forcePoints: 32,
            pathPoints: 128,
            tsize:0,
            fx: [],
            fy: [],
            fvx: [],
            fvy: [],
            fSize: [],
            x: [],
            y: [],
            vx: [],
            vy: [],
            timer: [],
            trigger: [],
            seed: [],
            iseed: [],
            init() {
                
                this.tsize=(w/6,w/2);
                this.tx = random(0, w-this.tsize);
                this.ty = random(0, h-this.tsize);
                this.seed[0] = rSeed(3) +3;
                this.seed[1] = rSeed(3) + 1;
                this.seed[2] = rSeed(3) + 2;
                this.seed[3] = rSeed(3) + 2;
                this.seed[4] = rSeed(3) + 2;
                for (let i = 0; i < this.forcePoints; i++) {
                    this.fx[i] = random(0, w);
                    this.fy[i] = random(0, h);
                    var angle = Math.PI / 6 * rSeed(12);
                    this.fvx[i] = Math.cos(angle);
                    this.fvy[i] = Math.sin(angle);
                    this.fSize[i] = random(w / 50, w / 18);

                };
                for (let j = 0; j < this.pathPoints; j++) {
                    this.x[j] = random(0, w);
                    this.y[j] = random(0, h);
                    var angle = Math.PI / 6 * rSeed(12);
                    this.vx[j] = Math.cos(angle);
                    this.vy[j] = Math.sin(angle);
                    this.timer[j] = 0;
                    this.trigger[j] = rSeed(200) + 100;
                    this.iseed[j] = rSeed(this.trigger[j]);
                }
            },
            draw() {
                if (time == 0) {
                    var fs=this.tsize/5;
                    var lh=1;
                    ctx.font=fs+'px Open Sans Condensed';
                    for(let tt=0;tt<this.string.length;tt++){
                        ctx.fillText(
                            this.string[tt],
                            this.tx+fs/6,
                            this.ty+lh*fs*tt+fs
                        )
                    }
                    ctx.font=10+'px Open Sans Condensed';
                    ctx.strokeRect(
                        this.tx,
                        this.ty,
                        this.tsize,
                        this.tsize
                    );
                    for (let i = 0; i < this.forcePoints; i++) {
                        if (i % this.seed[0] == 0) {

                            ctx.fillRect(
                                this.fx[i] - this.fSize[i] / 2,
                                this.fy[i] - this.fSize[i] / 2,
                                this.fSize[i],
                                this.fSize[i]
                            );

                            if (i % this.seed[1] == 0) {
                                ctx.strokeRect(
                                    this.fx[i] - this.fSize[i],
                                    this.fy[i] - this.fSize[i],
                                    this.fSize[i] * 2,
                                    this.fSize[i] * 2
                                );
                            }

                        }
                        if (i % this.seed[4] == 0) {
                            ctx.beginPath();
                            ctx.arc(
                                this.fx[i],
                                this.fy[i],
                                this.fSize[i] * 2,
                                0,
                                Math.PI * 2
                            );
                            ctx.stroke()
                        }

                    };
                }
                for (let jj = 0; jj < this.pathPoints; jj++) {
                    if (time == 0) {
                        ctx.beginPath();
                        ctx.arc(
                            this.x[jj],
                            this.y[jj],
                            w / 300,
                            0,
                            Math.PI * 2
                        )
                        ctx.stroke();
                        if (jj % this.seed[1] == 0) {
                            ctx.fillText(
                                Math.round(this.x[jj] * 100) / 100,
                                this.x[jj],
                                this.y[jj],
                            )
                        }
                    }
                    if (this.timer[jj] >= this.trigger[jj]) {
                        ctx.beginPath();
                        ctx.arc(
                            this.x[jj],
                            this.y[jj],
                            w / 300,
                            0,
                            Math.PI * 2
                        )
                        ctx.stroke();
                        this.x[jj] = random(0, w);
                        this.y[jj] = random(0, h);
                        var angle = Math.PI / 6 * rSeed(12);
                        this.vx[jj] = Math.cos(angle);
                        this.vy[jj] = Math.sin(angle);
                        this.timer[jj] = 0;
                        this.trigger[jj] = rSeed(200) + 100;
                        this.iseed[jj] = rSeed(this.trigger[jj]);
                        ctx.beginPath();
                        ctx.arc(
                            this.x[jj],
                            this.y[jj],
                            w / 300,
                            0,
                            Math.PI * 2
                        )
                        ctx.stroke();
                    }



                    for (let i = 0; i < this.forcePoints; i++) {
                        var d = dist(
                            this.fx[i],
                            this.fy[i],
                            this.x[jj],
                            this.y[jj],
                        )
                        if (d < w / 8) d = 1;
                        else d = 0;
                        this.vx[jj] += d * this.fvx[i];
                        this.vy[jj] += d * this.fvy[i];

                    }
                    if (this.vx[jj] > 0.5) this.vx[jj] = 0.5;
                    if (this.vx[jj] < -0.5) this.vx[jj] = -0.5;
                    if (this.vy[jj] > 0.5) this.vy[jj] = 0.5;
                    if (this.vy[jj] < -0.5) this.vy[jj] = -0.5;

                    this.x[jj] += this.vx[jj];
                    this.y[jj] += this.vy[jj];
                    ctx.fillRect(
                        this.x[jj],
                        this.y[jj],
                        1,
                        1
                    )
                    if (this.timer[jj] == this.iseed[jj]) {
                        if (jj % this.seed[3] == 0) {
                            ctx.fillRect(
                                this.x[jj] - w / 200,
                                this.y[jj] - w / 200,
                                w / 100,
                                w / 100)
                        } else {
                            ctx.strokeRect(
                                this.x[jj] - w / 200,
                                this.y[jj] - w / 200,
                                w / 100,
                                w / 100)
                        }


                    }
                    this.timer[jj]++
                }
            }
        };

        function animate() {
            //ctx.clearRect(0, 0, w, h);
            plane.draw();
            console.log(time);

            var raf = requestAnimationFrame(animate);

            time++
        };


        function rColor(s) {
            var seed = Math.round(Math.random() * 4);
            var color = [];
            color[0] = ["#571845", "#900c3e", "#c70039", "#ff5733", "#ffc300"];
            color[1] = ["#96ceb4", "#ffeead", "#ff6f69", "#ffcc5c", "#88d8b0"];
            color[2] = ["#173f5f", "#20639b", "#3caea3", "#f6d55c", "#ed553b"];
            color[3] = ["#999", "#777", "#555", "#333", "#111"];
            color[4] = ["#ffa239", "#c8e6c9", "#81c784", "#4caf50", "#ffe789"];
            color[5] = ["#428", "#6ca2ea", "#b5d33d", "#fed23f", "#eb7d5b"];
            var rgb = color[s][seed];
            return rgb;
        };

        function random(minR, maxR) {
            var r = minR + (maxR - minR) * Math.random();
            return r
        };

        function rSeed(value) {
            var seed = Math.round(Math.random() * value);
            return seed
        };

        function dist(x1, y1, x2, y2) {
            var dx = Math.abs(x1 - x2);
            var dy = Math.abs(y1 - y2);
            var d = Math.max(dx, dy);
            return d
        }
    </script>
</head>

<body>
    *
</body>

</html>