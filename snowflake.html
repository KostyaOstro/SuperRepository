<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            padding: 0px;
            margin: 0px
        }
    </style>
    <script>
        var ctx, w, h, ctx2, mctx;
        var time = 0;
        var segments = 20;
        var angle = Math.PI*2 / segments;
        var clip;
        var inMemoryCanvas;

        window.onload = function () {
            var canvas = document.createElement("canvas");
            //canvas.setAttribute("id", "canvas");
            document.body.appendChild(canvas);
           // canvas = document.getElementById("canvas");
            w = 600;
            h = 600;
            canvas.width = w;
            canvas.height = h;
            ctx = canvas.getContext("2d");

            var canvas2 = document.createElement("canvas");
            //canvas2.setAttribute("id", "canvas2");
            document.body.appendChild(canvas2);
            //canvas2 = document.getElementById("canvas2");
            canvas2.width = w * 2;
            canvas2.height = h * 2;
            ctx2 = canvas2.getContext("2d");

             inMemoryCanvas = document.createElement('canvas');
             mctx = inMemoryCanvas.getContext("2d");
             inMemoryCanvas.setAttribute('width',w*0.6);
            inMemoryCanvas.setAttribute("height",h*0.6);


            image = document.getElementById('tex');
            animate();
        }

        function clearFrame() {
            ctx.clearRect(0, 0, w, h)
            ctx2.clearRect(0, 0, w*2, h*2)
        }

        function draw() {
            ctx.save();
            //console.log(angle);
            var gip =w/ Math.cos(angle) ;
            var sin = Math.abs(Math.sin(angle) * gip);
            // console.log("gip", gip);
            //console.log("sin", sin)
            
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(w, 0);
            ctx.lineTo(w, sin);
            ctx.closePath();
            //ctx.stroke();
            ctx.clip();
            ctx.fillStyle ="black";
            ctx.fillRect(0,0,w,h);
            for (i = 0; i < 100; i++) {
                // for (j = 0; j < 10; j++) {
                var x = Math.round(Math.random() * w);
                var y = Math.round(Math.random() * h);
                ctx.fillStyle = rColor();
                ctx.fillRect(x, y, 50, 50)
                // }
            }
          
            var clip=ctx.getImageData(0,0,w,sin);
            mctx.putImageData(clip, 0, 0, 0, 0,w,sin);
            //mctx.drawImage(inMemoryCanvas, x, y)

            ctx2.restore();
            ctx2.save();
            ctx2.translate(w, h);

            for (j = 0; j < segments; j++) {
                ctx2.scale(0.985,0.985 );
                ctx2.rotate(angle );
               ctx2.drawImage(inMemoryCanvas, 0, 0);
            }
            ctx2.restore();
            for (j = 0; j <segments; j++) {
                ctx2.restore();
                ctx2.save();
                
                ctx2.translate(w+Math.cos(angle*j)*15*j, h+Math.sin(angle*j)*15*j);
                console.log(sin);
               // console.log(j);
                //ctx2.scale(0.985,0.985 );
                ctx2.rotate(angle*j);
                ctx2.scale(1-0.05*j,1-0.05*j );
                ctx2.drawImage(inMemoryCanvas, 0, 0);
                
            }
            

        }

        function rColor() {
            var r = Math.round(Math.abs(Math.sin(Math.random()) * 128)) + 128;
            var g = 0;
            var b = r;
            var rgb = "rgb(" + r + "," + g + "," + b + ")";
            return rgb;
        }

        function animate() {
            clearFrame();
            draw(time);
           window.requestAnimationFrame(animate);
            time++
        }
    </script>
</head>
<script src="javascripts/three.js"></script>





<body>
    <script>

    </script>
   
</body>

</html>