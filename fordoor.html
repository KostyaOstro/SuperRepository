<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:900" rel="stylesheet">
</head>
<script>
    var time = 0;
    var canvas, ctx;
    var canvas2, ctx2;
    var w = h = 1024;
    var sw = sh = 128;
    var size = w / sw;
    var gsc, bg;
    var string = ["I LOVE U", "PLATO"];
    var fs = h / 12;
    var lh = 0.8;
    var img = {
        x: [],
        y: [],
        v: [],
        seed:[]
    };
    var data;
    window.onload = function () {
        gsc = rSeed(5);
        bg = rColor(gsc);

        canvas = document.createElement("canvas");
        canvas.width = w;
        canvas.height = h;
        document.body.appendChild(canvas);
        ctx = canvas.getContext("2d");

        canvas2 = document.createElement("canvas");
        canvas2.width = sw;
        canvas2.height = sh;
        document.body.appendChild(canvas2);
        ctx2 = canvas2.getContext("2d");
        ctx2.fillStyle = 'white';
        ctx2.fillRect(0, 0, sw, sh);


        var image = new Image();
        image.src = '/images/pluto.jpg';
        image.addEventListener("load", function () {
            ctx2.drawImage(image, 0, 0, sw * 0.8, sh);
            var massive = ctx2.getImageData(0, 0, sw, sh);
            data = massive.data;
            for (let i = 0; i < data.length; i += 4) {

                if (data[i] < 200) {
                    //console.log(data[i]);
                    var x = i / 4 % sw;
                    var y = Math.floor(i / 4 / sw);
                    var v = 1 - data[i] / 255;
                    img.x.push(x);
                    img.y.push(y);
                    img.v.push(v);
                    var seed = rSeed(3);
                    img.seed.push(seed);
                }
            };

            ctx.font = fs + 'px Roboto';
            ctx.textAlign = "center";
            animate()

        })

        // console.log(data)


    }



    function animate() {
        ctx.fillStyle='white';
        ctx.fillRect(0, 0, w, h);
        ctx.fillStyle='#cab5ff';
        ctx.beginPath();
        ctx.arc(w/2,h/2,w/2.5,0,Math.PI*2);
        ctx.fill();
        ctx.fillStyle='black';
        ctx.lineWidth=1;
        for (let i = 0; i < img.x.length; i++) {
            switch (img.seed[i]) {
                case 1:
                     ctx.fillRect(
                        w / 10 + img.x[i] * size + Math.cos(time / 50 + i / sw * 2) * 5,
                        img.y[i] * size + Math.sin(time / 50 + i / sh * 10) * 5,
                        img.v[i] * size,
                        img.v[i] * size
                    )
                    break;
                case 2:
                    ctx.fillRect(
                        w / 10 + img.x[i] * size + Math.cos(time / 50 + i / sw * 2) * 5,
                        img.y[i] * size + Math.sin(time / 50 + i / sh * 10) * 5,
                        img.v[i] * size,
                        img.v[i] * size
                    )
                    break;
                default:
                    ctx.fillRect(
                        w / 10 + img.x[i] * size + Math.cos(time / 50 + i / sw * 2) * 5,
                        img.y[i] * size + Math.sin(time / 50 + i / sh * 10) * 5,
                        img.v[i] * size,
                        img.v[i] * size
                    )
            }

        }
        ctx.save();
        var k = Math.cos(time / 100) * 0.2;
        ctx.setTransform(1, k, 0, 1, w / 2, 0);
        ctx.fillStyle = 'white';
        ctx.fillRect(-fs * 2.2, fs * 9, fs * 4.4, h / 2);
        ctx.fillStyle = 'black';
        ctx.lineWidth = 2;
        for (let j = 0; j < 8; j++) {
            for (let i = 0; i < string.length; i++) {
                ctx.strokeText(
                    string[i],
                    0,
                    h * 5 / 6 + fs * lh * i + j * fs * lh * 0.8
                )
            }
        }

        for (let i = 0; i < string.length; i++) {
            ctx.fillText(
                string[i],
                0,
                h * 5 / 6 + fs * lh * i
            )
        }
        ctx.restore();


        time++;
        requestAnimationFrame(animate)
    }

    function rColor(s) {
        var seed = Math.round(Math.random() * 4);
        var color = [];
        color[0] = ["#571845", "#900c3e", "#c70039", "#ff5733", "#ffc300"];
        color[1] = ["#96ceb4", "#ffeead", "#ff6f69", "#ffcc5c", "#88d8b0"];
        color[2] = ["#173f5f", "#20639b", "#3caea3", "#f6d55c", "#ed553b"];
        color[3] = ["#999", "#777", "#555", "#333", "#111"];
        color[4] = ["#ffa239", "#c8e6c9", "#81c784", "#4caf50", "#ffe789"];
        color[5] = ["#428", "#6ca2ea", "#b5d33d", "#fed23f", "#eb7d5b"];
        var rgb = color[s][seed];
        return rgb;
    };

    function random(minR, maxR) {
        var r = minR + (maxR - minR) * Math.random();
        return r
    };

    function rSeed(value) {
        var seed = Math.round(Math.random() * value);
        return seed
    };
</script>

<body>
    *
</body>

</html>