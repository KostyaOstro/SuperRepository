<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            padding: 0px;
            margin: 0px
        }
    </style>

</head>
<link href="https://fonts.googleapis.com/css?family=Roboto:900" rel="stylesheet">
<script src="javascripts/three.js"></script>
<script src="javascripts/orbitcontrols.js"></script>

<body>
    <script>
        var time = 0;


        var drawingCanvas = document.createElement('canvas');
        drawingCanvas.setAttribute("id", "drawingCanvas")
        document.body.appendChild(drawingCanvas);
        var ctx = drawingCanvas.getContext("2d");
        drawingCanvas = document.getElementById("drawingCanvas");
        var cw = 512;
        var ch = 512;
        drawingCanvas.height = ch;
        drawingCanvas.width = cw;
        initTexture();


        var w = window.innerWidth;
        var h = window.innerHeight;
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(65, w / h, 0.01, 2000);
        camera.position.z = 100;

        var renderer = new THREE.WebGLRenderer({
             antialias: true
        });
        renderer.setSize(w, h);
        document.body.appendChild(renderer.domElement);

        var light=new THREE.PointLight("red",1);
        scene.add(light);
        light.position.set(-50,150,50);

        var aoLight=new THREE.AmbientLight('blue',0.5);
        scene.add(aoLight);



        var boxG = new THREE.CylinderGeometry(
            3, // radiusTop: Float,
            2, // radiusBottom: Float,
            20, // height: Float,
            6, // radialSegments: Integer,
            1 // heightSegments: Integer,
            // openEnded: Boolean,
            // thetaStart: Float,
            // thetaLength: Float
        );
        //boxG.vertices[20].y = 25;
        //boxG.verticesNeedUpdate = true;
        var allPivots = new THREE.Object3D();
        var copies = 100;
        var box = [];
        var pivot=[];
        for (i = 0; i < copies; i++) {
            var tex = new THREE.CanvasTexture(drawingCanvas);
            pivot[i] = new THREE.Object3D();


            var boxM = new THREE.MeshStandardMaterial({
                roughness:0,
                flatShading:true,
                bumpMap:tex,
               // map: tex
                //wireframe: true
            });
            box[i] = new THREE.Mesh(boxG, boxM);
            box[i].position.y =10;
            pivot[i].add(box[i]);
            var size = Math.random() * 0.8 + 0.2;
           pivot[i].scale.set(size, size, size);
            
            


            pivot[i].rotation.set(Math.random() * Math.PI * 2, Math.random() * Math.PI * 2, Math.random() * Math.PI * 2);
            allPivots.add(pivot[i]);
        }






        scene.add(allPivots);
        animate();



        function animate() {
            for (i = 0; i < copies; i++) {
                pivot[i].scale.y = Math.abs(Math.sin(time / 50 + i / 20) * 0.8)+0.2;
                //box[i].scale.set(size, size, size);
            }
            // boxM.map.needsUpdate = true;
            allPivots.rotation.y += 0.01;
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
            time++
        }


        function rColor() {

            var seed = Math.round(Math.random() * 6);
            switch (seed) {
                case 1:
                    var r = Math.round(Math.random() * 128) + 64;
                    var g = Math.round(Math.random() * 128) + 64;
                    var b = 0;
                    break;
                case 2:
                    var r = 0; // Math.round(Math.abs(Math.sin(Math.random()) * 128)) + 128;
                    var g = Math.round(Math.random() * 128) + 64;
                    var b = Math.round(Math.random() * 128) + 64;
                default:
                    var r = Math.round(Math.random() * 128) + 64;
                    var g = 0; //Math.round(Math.abs(Math.sin(Math.random()) * 128)) + 128;
                    var b = Math.round(Math.random() * 128) + 64;
                    break;
            }
            var rgb = "rgba(" + r + "," + g + "," + b + ",0.7)";
            return rgb;
        }

        function initTexture() {
            var slice = [];
            var stopWidth = 0;
            slicing();

            function slicing() {

                if (stopWidth < (cw - 5)) {
                    var value = 32;
                    var lastValue = cw - stopWidth;
                    if (lastValue < value) {
                        value = lastValue
                    }
                    var s = Math.round(Math.random() * value);
                    stopWidth += s;
                    slice.push(s);
                    //console.log("s=",s,"stopWidth=",stopWidth);
                    slicing();

                } else {
                    var s = cw - stopWidth;
                    slice.push(s);
                    //console.log("s=",s,"stopWidth=",stopWidth);
                    return
                }
            }
            var offset = 0;
            for (i = 0; i < slice.length; i++) {
                ctx.fillStyle = rColor();
                ctx.fillRect(offset, 0, slice[i], ch);
                offset += slice[i];
            }
        }

        // function clearFrame() {
        //     ctx.clearRect(0, 0, w, h);
        // }
    </script>

</body>

</html>