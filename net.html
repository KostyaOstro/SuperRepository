<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="/javascripts/three.js"></script>
    <script src="/javascripts/myLib.js"></script>
    <script id="fragmentShader2" type='x-shader/x-fragment'>
        uniform float time;
        varying vec2 vv;
        varying vec3 n;
        varying vec3 p;
        varying vec4 n2;
        varying vec4 p2;

        void main(){
            
            vec3 c = vec3(p2.x / 25. , 0.,1. - p2.x / 25.);
           
            gl_FragColor = vec4(c, 1.);
        }
    </script>
    <script id="fragmentShader" type='x-shader/x-fragment'>
        uniform float time;
        varying vec2 vv;
        varying vec3 n;
        varying vec3 p;
        varying vec4 n2;
        varying vec4 p2;

        void main(){
            float col = length(p) / 50.;
            if(col > .7)discard;
            gl_FragColor = vec4(vec3(0., 1.- col, col), 1.);
        }
    </script>
    <script id="fragmentShader3" type='x-shader/x-fragment'>
        uniform float time;
        varying vec2 vv;
        varying vec3 n;
        varying vec3 p;
        varying vec4 n2;
        varying vec4 p2;

        void main(){
            float col2 = length(p) / 50.;
            float col = step(.5, fract(length(p) / 50.* 30.)) ;
            if(col2 > .9)discard;
            if(col > .7)discard;
            vec3 c = vec3(1.- col2, col2,1.);
            if(!gl_FrontFacing)c *= .8;
            gl_FragColor = vec4(c, 1.);
        }
    </script>
    <script id="vertexShader2" type='x-shader/x-vertex'>
        uniform float time;
        varying vec2 vv;
        varying vec3 n;
        varying vec3 p;
        varying vec4 n2;
        varying vec4 p2;
        void main(){
            vv = uv;
            n = normal;
            
            n2 =  modelViewMatrix * vec4(normal, 0.) ;
            p2 =  modelViewMatrix * vec4(position, 1.) ;

            float x = position.x + cos(position.y / 200. * 25. + time) * 11.;
            float y = position.y + cos(position.z / 200. * 22. + time) * 17.;
            float z = position.z + cos(position.x / 200. * 10. + time) *13.;
            p = vec3(x, y, z);
            gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.);
        }
    </script>
    <script id="vertexShader" type='x-shader/x-vertex'>
        uniform float time;
        varying vec2 vv;
        varying vec3 n;
        varying vec3 p;
        varying vec4 n2;
        varying vec4 p2;
        void main(){
            vv = uv;
            n = normal;
            p = position;
            n2 =  modelViewMatrix * vec4(normal, 0.) ;
            p2 =  modelViewMatrix * vec4(position, 1.) ;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);
        }
    </script>
    <title>Document</title>
</head>

<body>
    <script>
        var time = 0;
        var w = h = 1024;

        var canvas = document.createElement("canvas");
        canvas.width = w;
        canvas.height = h;
        document.body.appendChild(canvas);
        var ctx = canvas.getContext("2d");

       

        if (ctx) {
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(65, w / h, .01, 2000);
            camera.position.z = 100;
            var renderer = new THREE.WebGLRenderer({
                alpha: true
            });
            //renderer.setClearColor(new THREE.Color('white'));
            renderer.setSize(w, h);
            //document.body.appendChild(renderer.domElement);
            var pivot = new THREE.Object3D();

            var uniforms = {
                time: {
                    type: "f",
                    value: 0
                }
            };

            var lmaterial = new THREE.ShaderMaterial({
                fragmentShader: document.getElementById('fragmentShader').textContent,
                vertexShader: document.getElementById('vertexShader').textContent,
                uniforms: uniforms,
                side: THREE.DoubleSide,
                linewidth: 6,
            });
            for (let j = 0; j < 23; j++) {
                if (rSeed(10) < 9) {
                    var r = random(0.2, 0.7);
                }else{
                    var r = random(0.5, 3);
                }
               
                var g = new THREE.Geometry();
                var angle = random(0, Math.PI * 2);
                var distance = random(0, 50);
                var path = new THREE.Path();
                path.getPoint = function (t) {
                    let x = t * 100 - 50;
                    let y = Math.sin(angle) * distance + Math.cos(t * j / 15 * 8) * 20;
                    let z = Math.cos(angle) * distance + Math.sin(t * j / 15 * 17) * 20;
                    return new THREE.Vector3(x, y, z);
                }
                var g = new THREE.TubeGeometry(path, 80, r, 10, true);
                var line = new THREE.Mesh(g, lmaterial);
                pivot.add(line);

            }

            for (let j = 0; j < 20; j++) {
                let s = random(0.1, 2) + random(0.1, 5);

                var material = new THREE.ShaderMaterial({
                    fragmentShader: document.getElementById('fragmentShader2').textContent,
                    vertexShader: document.getElementById('vertexShader').textContent,
                    uniforms: uniforms,

                });
                var geometry = new THREE.SphereGeometry(s, 20, 20);
                var sphere = new THREE.Mesh(geometry, material);
                sphere.position.z = random(10, 30);
                var spherePivot = new THREE.Object3D();
                spherePivot.add(sphere);
                let x = random(0, Math.PI * 2);
                let y = random(0, Math.PI * 2);
                let z = random(0, Math.PI * 2);
                spherePivot.rotation.set(
                    x,
                    y,
                    z
                )
                pivot.add(spherePivot)

            }

            var material = new THREE.ShaderMaterial({
                fragmentShader: document.getElementById('fragmentShader3').textContent,
                vertexShader: document.getElementById('vertexShader2').textContent,
                uniforms: uniforms,
                side: THREE.DoubleSide,

            });
            var geometry = new THREE.SphereGeometry(60, 60, 60);
            var sphere = new THREE.Mesh(geometry, material);
            pivot.add(sphere);
            scene.add(pivot);

            



            animate()
        }

        function animate() {
            ctx.lineWidth = 3;
            pivot.rotation.y += .01;
            uniforms.time.value = time;
            renderer.render(scene, camera);
            ctx.fillStyle = 'white';
            ctx.fillRect(0,0,w,h);
            ctx.strokeStyle = 'blue';
            var fs = h / 10;
            var lh = .8;
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(
                w / 2,
                h / 2,
                w / 2.8,
                0,
                Math.PI * 2
                );
            ctx.stroke();
            ctx.font = 'bold ' + fs + 'px Arial';
           
            ctx.fillStyle = 'black';
            //ctx.textAlign = "center";
            var txt = "ABSTRACT #69";
            for (let j = 0; j < txt.length; j++) {
                ctx.save();
                let a = j * Math.PI / txt.length + time;
                let x = w/2 + Math.cos(a) * w / 3;
                let y = h/2 + Math.sin(a) * w / 3;
                ctx.translate(x, y);
                ctx.rotate(a + Math.PI / 2);
                ctx.strokeText(
                    txt[j],
                    0,
                    0
                );
                ctx.restore();
            }



            ctx.drawImage(renderer.domElement, 0., 0.);
            requestAnimationFrame(animate);
            time += .01;
        }
    </script>
</body>

</html>