<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script>
        var w = h = 1024;
        var time = 0;
        var canvas, ctx, tex;
        var fs, lh;
        var arr = 'QWRTPSDFGHJKLZXCVBNMЙЦКНГШЩЗХЪФВПРЛДЖЧСМТЬБб0468';
        var sum = '';
        var symbol = '-'; //'@#%&*/-+=~:$';
        var seed1 = seed2 = seed3 = 0;
        var gridX;
        var water;
        var gridY;
        var gridL;
        var stepX;
        var stepY;
        var letInString;
        var t;
        var l;
        var vowel;
        var type = [];
        var raf;
        var color = [
            "black",
            "blue",
            "white"
        ]


        window.onload = function () {


            tex = document.getElementById('tex');
            canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;
            document.body.appendChild(canvas);
            ctx = canvas.getContext("2d");

            tex.onkeypress = function (e) {

                if (e.keyCode == 13) {
                    draw()
                }
            }
        }

        function draw() {

            clear()
            sum = '';
            t = '';
            t = tex.value;

            t = t.toUpperCase();
            l = t.length;

            seed1 = l % 10;
            seed2 = 1;
            if (l % 2 == 0) {
                seed2 = 0
            };
            vowel = 0;

            for (let i = 0; i < l; i++) {
                sum += t.charAt(i).charCodeAt(0).toString(2);
                var tt = t.charAt(i);

                if (arr.indexOf(tt) !== -1) {

                    vowel += 1;
                }
            }
            seed3 = vowel / l;



            gridX = rSeed(4) + 2;
            water = rSeed(2) + 1;
            gridY = Math.ceil(l / gridX * water);
            gridL = gridX * gridY;
            stepX = w / (gridX + 1);
            stepY = h / (gridY + 1);
            letInString = Math.ceil(l / gridY);

            cancelAnimationFrame(raf)
            console.log(l);
            animate()

        }

        function animate() {
            clear();
            raf = requestAnimationFrame(animate);
            abstract.draw();
            textDraw();
            time++;
        }

        function rColor(s) {
            var seed = Math.round(Math.random() * 4);
            var color = [];
            color[0] = ["#571845", "#900c3e", "#c70039", "#ff5733", "#ffc300"];
            color[1] = ["#96ceb4", "#ffeead", "#ff6f69", "#ffcc5c", "#88d8b0"];
            color[2] = ["#173f5f", "#20639b", "#3caea3", "#f6d55c", "#ed553b"];
            color[3] = ["#999", "#777", "#555", "#333", "#111"];
            color[4] = ["#ffa239", "#c8e6c9", "#81c784", "#4caf50", "#ffe789"];
            color[5] = ["#428", "#6ca2ea", "#b5d33d", "#fed23f", "#eb7d5b"];
            var rgb = color[s][seed];
            return rgb;
        };

        function random(minR, maxR) {
            var r = minR + (maxR - minR) * Math.random();
            return r
        };

        function rSeed(value) {
            var seed = Math.round(Math.random() * value);
            return seed
        };

        function clear() {
            ctx.fillStyle = color[0];
            ctx.fillRect(0, 0, w, h);
            ctx.fillStyle = color[1];
        }

        function setFont(gridY) {
            fs = h / (gridY + 1) / 2;
            lh = 1;
            ctx.font = 'bold ' + fs * lh + 'px arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = color[2];
        }

        function textDraw() {
            let wordProgress = 0;
            setFont(gridY);




            if (time == 0) {
                for (let ii = 0; ii < gridL; ii++) {
                    type[ii] = "-";
                    var x = ii % gridX;
                    var y = Math.floor(ii / gridX);
                    if (wordProgress < l) {

                        if (
                            rSeed(water) < Math.floor(water / 2) ||
                            wordProgress < letInString * (y + 1) ||
                            (gridL - ii) == (l - wordProgress)
                        ) {



                            type[ii] = t[wordProgress];
                            wordProgress += 1;


                        }

                    }
                    ctx.fillText(
                        type[ii],
                        stepX * (x + 1),
                        stepY * (y + 1)
                    )
                };
            } else {
                for (let ii = 0; ii < gridL; ii++) {
                    x = ii % gridX;
                    y = Math.floor(ii / gridX);
                    ctx.fillText(
                        type[ii],
                        stepX * (x + 1),
                        stepY * (y + 1)
                    )
                }
            }




        }

        var abstract = {
            steps: 150,
            x: [],
            y: [],
            size: [],
            side: [],
            color: [],
            draw() {

                for (let i = 0; i < this.steps; i++) {
                    var n = i / this.steps;
                    this.x[i] = w / 2 + Math.cos(n * 7 + time / 50) * w / 3;
                    this.y[i] = w / this.steps * i + Math.cos(n * 26 + time / 50) * w / 8;
                    let rr = Math.cos(n * 9 + time / 30) * w / 40 + w / 20;
                    ctx.fillStyle = color[0];
                    ctx.strokeStyle = color[1];
                    ctx.lineWidth = 2;
                    let angle = Math.cos(n * 4 + time / 80) * Math.PI * 2;
                    let line = Math.cos(n * 20 + time / 20) * w / 4;
                    ctx.save();

                    ctx.translate(
                        this.x[i],
                        this.y[i],
                    );
                    ctx.rotate(angle);
                    ctx.fillRect(
                        0,
                        0,
                        line,
                        5
                    )
                    ctx.strokeRect(
                        0,
                        0,
                        line,
                        5
                    )
                    ctx.restore();



                    ctx.beginPath();
                    ctx.arc(
                        this.x[i],
                        this.y[i],
                        rr,
                        0,
                        Math.PI * 2
                    );
                    ctx.fill();
                    ctx.stroke();



                    for (let j = 0; j < 7; j++) {
                        var x2 = this.x[i] + Math.cos(j * 25 + time / 50 + n * 7) * w / 5;
                        var y2 = this.y[i] + Math.sin(j * 20 + time / 50 + n * 7) * w / 5;
                        let rr2 = Math.cos(j * 4 + time / 30 + n * 12) * w / 100 + w / 60;
                        ctx.fillStyle = color[0];
                        ctx.lineWidth = 1;
                        ctx.strokeStyle = color[1];


                        //if (j == 0) {
                        ctx.save();
                        let angle = Math.cos(n * 4 + time / 80 + j) * Math.PI * 2;
                        let line = Math.cos(n * 20 + time / 20 + j) * w / 8;
                        ctx.translate(
                            x2,
                            y2,
                        );
                        ctx.rotate(angle);
                        ctx.fillRect(
                            0,
                            0,
                            line,
                            5
                        )
                        ctx.strokeRect(
                            0,
                            0,
                            line,
                            5
                        )
                        ctx.restore();
                        //}






                        ctx.beginPath();
                        ctx.arc(
                            x2,
                            y2,
                            rr2,
                            0,
                            Math.PI * 2
                        );
                        ctx.fill();
                        ctx.stroke();



                    }
                }
            }
        }
    </script>
</head>

<body>
    <input type="text" name="tex" id="tex">
</body>

</html>