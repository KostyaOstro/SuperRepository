<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:900" rel="stylesheet">
    <script src="/javascripts/three.js"></script>
    <script src="/javascripts/myLib.js"></script>
    
    <script id="fragmentShader" type='x-shader/x-fragment'>
        uniform float time;
        uniform sampler2D texture0;
        uniform sampler2D texture1;
        uniform sampler2D texture2;
        uniform sampler2D texture3;
        varying vec2 vUv;
        varying vec3 nrm;
       

        void main(){
            
            vec2 mv = vUv;
            vec2 mv2 = vUv;
           
            
            vec4 img1 = texture2D(texture1, mv);
            
           
            vec4 img01 = texture2D(texture0, mv2);
            
            vec4 img2 = texture2D(texture1, mv);
           // mv += fract(mv * 60.) / 60.;
            vec4 img4 = texture2D(texture1, mv);
            for(float i = 1.; i < 10.; i++){
                mv.x -= i * 0.01;
                img4 = texture2D(texture1, mv);
                img2.r += img4.r / i;
                img2.g += img4.r / (10. - i);
            }
            float l = length(vUv - .5);
            mv2 += (img2.r) / 50. * cos(floor( l * 60.)) ;
            vec4 img0 = texture2D(texture0, mv2);
            vec3 col = vec3(1.- img0.r,1.- img0.r,1. );
            gl_FragColor = vec4(col, 1.);
        }

    </script>
    <script id="vertexShader" type='x-shader/x-vertex'>
        uniform float time;
        varying vec2 vUv;
        varying vec3 nrm;

        void main(){
            nrm = normal;
            vUv = uv;
            float z = position.z;
            float y = position.y;
            float x = position.x;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4(x,y,z, 1.);
        }

    </script>
</head>

<body>
        <video id="video" loop crossOrigin="anonymous" webkit-playsinline style="display:none">
            <source src="/video/samba.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
    </video>
    <script>
      
        var time = 0;
        var w = h = 1024;

        var canvas = document.createElement("canvas");
        canvas.width = w;
        canvas.height = h;
        //document.body.appendChild(canvas);
        var ctx = canvas.getContext("2d");

        var fs = h / 4;
        var lh = .8;
        ctx.font = 'bold ' + fs + 'px Arial';
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, w, h);
        ctx.fillStyle = 'black';
        //ctx.textAlign = "center";
        var txt = ["DANCE", "WITH", "SOME-", "BODY"] ;
        for (let j = 0; j < 4; j++){
            ctx.fillText(
                txt[j % txt.length],
                w / 20,
                fs + j * lh * fs
            )
        }
        var video = document.getElementById( 'video' );
		//video.play();
        var tex1 = new THREE.VideoTexture(video);
        var tex2 = new THREE.TextureLoader().load("/images/russia/2.jpg"); 
        var tex3 = new THREE.TextureLoader().load("/images/russia/3.jpg"); 
        

        if (ctx) {

            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(65, w / h, .01, 2000);
            camera.position.set(0, 0, 75);
            var renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.setSize(w, h);
            document.body.appendChild(renderer.domElement);
            var tex0 = new THREE.CanvasTexture(canvas);
            var uniforms = {
                time: {
                    type: 'f',
                    value: 0
                },
                'texture0': {
                    value: tex0
                },
                'texture1': {
                    value: tex1
                },
                'texture2': {
                    value: tex2
                },
                'texture3': {
                    value: tex3
                }
            };


            var material = new THREE.ShaderMaterial({
                //map: tex1,
                uniforms: uniforms,
                fragmentShader: document.getElementById('fragmentShader').textContent,
                vertexShader: document.getElementById('vertexShader').textContent,
                side: THREE.DoubleSide,
                //wireframe: true
            });

            
            var geometry = new THREE.PlaneGeometry(100,100);
            var mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);
                
            


            renderer.domElement.onclick = function(){
                video.play();
            }

            animate()
        }

        function animate() {
            //mesh.material.map.needsUpdate = true;
            //mesh.rotation.y += .001;
            //tex1.needsUpdate = true;
            requestAnimationFrame(animate);
            time += .1;
            uniforms.time.value = time;
            renderer.render(scene, camera)
        }

    </script>
   
</body>

</html>