<!DOCTYPE html>
<html lang="en">

<head>
    <title>three.js webgl - geometry - vertex colors</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

</head>

<body>



    <script src="/javascripts/three.js"></script>

    <script>
        var gsc = rSeed(5);
        var container, stats;
        var camera, scene, renderer;
        var mouseX = 0,
            mouseY = 0;
        var windowHalfX = window.innerWidth / 2;
        var windowHalfY = window.innerHeight / 2;
        var mesh;
        var colors;
        var time = 0;
        var plane = [];
        var normals;
        var feather = [];
        init();
        animate();

        function init() {
            //container = document.getElementById( 'container' );
            camera = new THREE.PerspectiveCamera(20, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.z = 1800;
            scene = new THREE.Scene();
            //scene.background = new THREE.Color( 0xffffff );



            var radius = 200;
            plane = [
                new THREE.Plane(new THREE.Vector3(0, 0, 0), 0),

                //new THREE.Plane( new THREE.Vector3( 0, - 1, 0 ), 0 ),
                //new THREE.Plane( new THREE.Vector3( -1, 0, 0 ), -500 )
            ];
            var geometry = new THREE.IcosahedronGeometry(radius, 1);
            var material = new THREE.MeshBasicMaterial({
                wireframe: true,
                // clippingPlanes:plane,
                clipIntersection: true,
                //vertexColors: THREE.VertexColors,
                side: THREE.DoubleSide
            });
            normals = [];
            colors = [];
            position = [];

            for (let i = 0; i < geometry.vertices.length; i++) {
                colors[i] = 0;
                normals[ipoint] = 0;
                var planeG = new THREE.PlaneGeometry(60, 60, 1, 1);
                var fmaterial = new THREE.MeshBasicMaterial({
                    side: THREE.DoubleSide
                });
                feather[i] = new THREE.Mesh(planeG, fmaterial);
                var x = geometry.vertices[i].x;
                var y = geometry.vertices[i].y;
                var z = geometry.vertices[i].z;
                //feather[i].position.set(x,y,z);
                scene.add(feather[i]);


            }

            for (let i = 0; i < geometry.faces.length; i++) {
                for (j = 0; j < 3; j++) {
                    var string = "abc";
                    var ipoint = geometry.faces[i][string[j]];

                    var point = geometry.vertices[ipoint];
                    if (colors[ipoint] == 0) {
                        var rgb = new THREE.Color(rColor(gsc));
                        colors[ipoint] = rgb;
                        normals[ipoint] = geometry.faces[i].vertexNormals[j];
                        position[ipoint] = geometry.vertices[ipoint];
                        // console.log(normals[ipoint] )
                    } else {
                        var rgb = colors[ipoint]
                    }

                    geometry.faces[i].vertexColors.push(rgb)
                }

            }
         
            for (let i = 0; i < geometry.vertices.length; i++) {
                // console.log(i);
                var xn = normals[i].x;
                var yn = normals[i].y;
                var zn = normals[i].z;

                var xp = position[i].x;
                var yp = position[i].y;
                var zp = position[i].z;
                //feather[i].up=new THREE.Vector3(0,1,0);
                //feather[i].up.set(Math.cos(Math.PI/2), Math.sin(Math.PI/2), 0);
                feather[i].position.set(xp, yp, zp);
                //feather[i].lookAt(camera.position);
                //feather[i].rotation.y += Math.PI / 2;
                // feather[i].rotation.z=-Math.PI/2


            }


            mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh)
            helper = new THREE.VertexNormalsHelper(mesh, 50, 0x00ff00, 1);
            scene.add(helper);
            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.localClippingEnabled = true;
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            document.addEventListener('mousemove', onDocumentMouseMove, false);
            //
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onDocumentMouseMove(event) {
            mouseX = (event.clientX - windowHalfX)*5;
            mouseY = (event.clientY - windowHalfY)*5;
        }
        //
        function animate() {
            requestAnimationFrame(animate);
            render();
            //stats.update();
        }

        function render() {
            // mesh.rotation.y += 0.01;
            var x = Math.cos(time / 50);
            var y = Math.sin(time / 50);
            var z = Math.cos(time / 20);
            // mesh.lookAt(x,y,z);
            //feather[0].lookAt(x,y,z)
          
            camera.position.x += (mouseX - camera.position.x) * 0.1;
            camera.position.y += (-mouseY - camera.position.y) * 0.1;
            for (let i = 0; i < feather.length; i++) {
                feather[i].lookAt(camera.position);
            }
            camera.lookAt(scene.position);
            renderer.render(scene, camera);
            time++
            
        }

        function rColor(s) {
            var seed = Math.round(Math.random() * 4);
            var color = [];
            color[0] = ["#571845", "#900c3e", "#c70039", "#ff5733", "#ffc300"];
            color[1] = ["#96ceb4", "#ffeead", "#ff6f69", "#ffcc5c", "#88d8b0"];
            color[2] = ["#173f5f", "#20639b", "#3caea3", "#f6d55c", "#ed553b"];
            color[3] = ["#999", "#777", "#555", "#333", "#111"];
            color[4] = ["#ffa239", "#c8e6c9", "#81c784", "#4caf50", "#ffe789"];
            color[5] = ["#428", "#6ca2ea", "#b5d33d", "#fed23f", "#eb7d5b"];
            var rgb = color[s][seed];
            return rgb;
        };

        function random(minR, maxR) {
            var r = minR + (maxR - minR) * Math.random();
            return r
        };

        function rSeed(value) {
            var seed = Math.round(Math.random() * value);
            return seed
        };
    </script>

</body>

</html>