<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="/javascripts/three.js"></script>
    <script src="/javascripts/myLib.js"></script>
    <title>Document</title>
    <script id='fragmentShader' type='x-shader/x-fragment'>
        uniform float time;
        uniform sampler2D texture1;
        varying vec2 mv;

        void main(){
            vec4 img = texture2D(texture1, mv);
            gl_FragColor = img;
        }

    </script>
    <script id='vertexShader' type='x-shader/x-vertex'>
        uniform float time;
        uniform sampler2D texture1;
        varying vec2 mv;

        void main(){
            mv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);
        }

    </script>
</head>

<body>
    <script>
        var time = 0;
        var step = 16;
        var cw = step * 22;
        var ch = step * 7;
        var w = h = step * 60;
        var uniforms;
        var copies = 28;
        var mcanvas = [];
        var mctx = [];
        var tex = [];
        var cube = [];
        var canvas = document.createElement("canvas");
        var scene, camera, renderer;
        var iw, ih;
        canvas.width = cw;
        canvas.height = ch;
        var ctx = canvas.getContext("2d");
        document.body.appendChild(canvas);

        var img = new Image();
        img.src = '/images/dumplogo.png';

        img.onload = function () {
            iw = img.width;
            ih = img.height;

            ctx.drawImage(
                img,
                0,
                0,
                iw,
                ih,
                0,
                0,
                cw,
                cw / iw * ih
            );
            for (let i = 0; i < copies; i++) {
                var ss = rSeed(6) + 1;
                mcanvas[i] = document.createElement("canvas");
                mcanvas[i].width = step * ss;
                mcanvas[i].height = step * ss;
                mctx[i] = mcanvas[i].getContext("2d");
                document.body.appendChild(mcanvas[i]);

                mctx[i].drawImage(
                    canvas,
                    rSeed(22 - ss) * step,
                    rSeed(7 - ss) * step,
                    step * ss,
                    step * ss,
                    0,
                    0,
                    step * ss,
                    step * ss
                )

            }
            canvas.width = w;
            canvas.height = h;
            ctx.fillRect(0, 0, w, h);
            animate();
        }

        var letters = {
            x: [],
            y: [],
            vx: [],
            vy: [],
            a: [],
            trigger: [],
            draw() {
                for (let i = 0; i < copies; i++) {
                    if (time == 0) {
                        let offset = 20;
                        this.x[i] = random(offset, 60 - offset - 3) * step;
                        this.y[i] = random(offset, 60 - offset - 3) * step;
                        this.a[i] = random(0, Math.PI * 2);
                        this.vx[i] = Math.cos(this.a[i]);
                        this.vy[i] = Math.sin(this.a[i]);
                        this.trigger[i] = random(2, 4);
                    }
                    this.x[i] -= this.vx[i];
                    this.y[i] -= this.vy[i];


                    if (time < this.trigger[i]) {
                        ctx.fillStyle = "white";
                        ctx.fillRect(
                            this.x[i] - Math.cos(this.a[i]) * step / 3,
                            this.y[i] - Math.sin(this.a[i]) * step / 3,
                            mcanvas[i].width,
                            mcanvas[i].height
                        )
                        ctx.drawImage(
                            mcanvas[i],
                            this.x[i],
                            this.y[i],
                        )

                        // if(rSeed(500) > 495){
                        //     let s2 = (rSeed(5) + 1) * step
                        //     ctx.beginPath();
                        //     ctx.rect( 
                        //         this.x[i],
                        //         this.y[i],
                        //         s2,
                        //         s2
                        //         )
                        //         ctx.fill()
                        // }
                    }

                }
            }
        }



        function animate() {

            if (time < 5) {
                requestAnimationFrame(animate);
                letters.draw();
            } else {
                let ww = step * 22;
                let xx = (w - ww) / 2;
                let hh = ww / iw * ih;
                let yy = (h - hh) / 2;
                ctx.fillRect(
                    xx + step / 3,
                    yy + step / 3,
                    ww ,
                    hh 
                )
                ctx.drawImage(
                    img,
                    0,
                    0,
                    iw,
                    ih,
                    xx,
                    yy,
                    ww,
                    hh
                    
                );
            }

            time += .01;
        }
    </script>
</body>

</html>