<!DOCTYPE html>
<html lang="en">

<head>
    <title>three.js webgl - loaders - OBJ loader</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>

    </style>
    <script src="javascripts/three.js"></script>
    <script src="javascripts/objloader.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:900" rel="stylesheet">
</head>

<body>




    <script>
        var container;
        var camera, scene, renderer;
        var object;
        var mesh;
        var mask;
        var time = 0;
        var ctx, canvas;
        var w = h = 512;
        var c = 0;
        var plane=[];
        var circle=[];
        var ipivot=[];
        var num=50;
        var num2=50;
        window.onload = function () {
            canvas = document.createElement("canvas");
            canvas.width = w;
            canvas.height = h;
            //ocument.body.appendChild(canvas);
            ctx = canvas.getContext("2d");
            pattern.init();
            init();
            animate();

        }
        var pattern = {
            num: 32,
            x: [],
            y: [],
            s: [],
            vx: [],
            vy: [],
            init() {
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, w, h);
                ctx.fillStyle = 'black';
                for (let i = 0; i < this.num; i++) {
                    this.x[i] = random(0, w);
                    this.y[i] = random(0, h);
                    this.vx[i] = random(-0.5, 0.5);
                    this.vy[i] = random(-0.5, 0.5);
                    this.s[i] = random(w / 60, w / 20);
                }

            },
            draw() {

                for (let i = 0; i < this.num; i++) {
                    if (this.x[i] > w || this.x[i] < 0) {
                        this.vx[i] *= -1;
                    };
                    if (this.y[i] > h || this.y[i] < 0) {
                        this.vy[i] *= -1;
                    }
                    this.x[i] += this.vx[i];
                    this.y[i] += this.vy[i];
                    ctx.strokeStyle = 'white';
                    ctx.fillStyle = 'black';
                    ctx.fillRect(
                        this.x[i],
                        this.y[i],
                        this.s[i],
                        this.s[i]
                    )
                    ctx.strokeRect(
                        this.x[i] - this.s[i] / 4,
                        this.y[i] - this.s[i] / 4,
                        this.s[i] / 2,
                        this.s[i] / 2
                    )
                };
                ctx.fillStyle = 'red';
                ctx.fillRect(
                    0,
                    h / 2.4,
                    w,
                    h / 5
                );
                ctx.font='100px Roboto';
                ctx.fillStyle = 'white';
                ctx.fillText(
                    'EAT ME, DRINK ME',
                    -time%w*3+w,
                    h/1.7
                )
            }
        }



        function init() {

            scene = new THREE.Scene();

            renderer = new THREE.WebGLRenderer({
                //autoClear:false,
                //preserveDrawingBuffer: true ,
               // alpha:true
            });
            //renderer.autoClearColor = false;
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerHeight, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            camera = new THREE.PerspectiveCamera(45, window.innerHeight / window.innerHeight, 1, 2000);
            camera.position.z = 250;



            var ambientLight = new THREE.AmbientLight(0xcccccc, 0.4);
            scene.add(ambientLight);
            var pointLight = new THREE.PointLight(0xffffff, 0.8);
            camera.add(pointLight);
            scene.add(camera);

            var tex = new THREE.CanvasTexture(canvas);
            // var texture = textureLoader.load('images/1.jpg');

            mask = new THREE.Object3D();

            var loader = new THREE.OBJLoader();
            loader.load(
                'obj/mask.obj',
                function (obj) {
                    obj.traverse(
                        function (child) {
                            if (child.isMesh) {
                                mesh = child;
                            }
                        }
                    );

                    //mesh.position.y = 20;
                    mesh.scale.set(0.5, 0.5, 0.5);
                    mesh.material.map = tex;
                    mesh.rotation.x = Math.PI / 6;
                    //object=obj;
                    mask.add(mesh);
                    
                },
                function onProgress() {

                },
                function onError() {}
            );


            
            var planeg = new THREE.PlaneGeometry(3, 50, 1, 1);
           
            
            
            for (let j = 0; j < num; j++) {
                if(j%2==0){
                    var planem = new THREE.MeshPhongMaterial({
                        color:'white'
                    });
                }
                if(j%3==0){
                    var planem = new THREE.MeshPhongMaterial({
                        color:'red'
                    });
                }
                plane[j] = new THREE.Mesh(planeg, planem);
                plane[j].position.y=50;
                plane[j].scale.y=0.6+0.4*Math.cos(j);
                ipivot[j]=new THREE.Object3D();
                ipivot[j].add(plane[j]);
                ipivot[j].rotation.z=-Math.PI/2+Math.PI/num*j;
                ipivot[j].position.y=20;
                mask.add(ipivot[j]);
            }
            
            var circleg=new THREE.CircleGeometry(50,32)
           
            for (let j = 0; j < num2; j++) {
                if(j%2==0){
                    var circlem = new THREE.PointsMaterial({
                        color:'white'
                    });
                }
                if(j%3==0){
                    var circlem = new THREE.PointsMaterial({
                        color:'red'
                    });
                }
                circle[j] = new THREE.Points(circleg, circlem);
                circle[j].rotation.x=Math.PI/2;
                circle[j].position.y=50-j*2;
                mask.add(circle[j]);
            }

            var squareg=new THREE.CircleGeometry(80,64);
            var squarem = new THREE.MeshBasicMaterial({
                        color:'white',
                        wireframe:true
                    });

            var square=new THREE.Mesh(squareg,squarem);
            square.position.z-=10;
            mask.add(square);
            scene.add(mask);
            mask.position.y-=10;

        }


        function animate() {
            for (let j = 0; j < num; j++) {
                plane[j].scale.y=0.3+Math.cos(j+time/50);
            };
            for (let j = 0; j < num2; j++) {
                var s=0.9+0.1*Math.cos(j/5+time/50);
                circle[j].scale.set(s,s,s)
            };
            pattern.draw();
            if (mesh) mesh.material.map.needsUpdate = true;
            mask.rotation.y = Math.cos(time / 50) / 8;
            mask.rotation.x = Math.cos(time / 100) / 4;
            requestAnimationFrame(animate);
            render();
            //drawCanvas();
            time++;
        }

        function render() {

            //camera.lookAt(scene.position);
            renderer.render(scene, camera);
        }

        function rColor(s) {
            var seed = Math.round(Math.random() * 4);
            var color = [];
            color[0] = ["#571845", "#900c3e", "#c70039", "#ff5733", "#ffc300"];
            color[1] = ["#96ceb4", "#ffeead", "#ff6f69", "#ffcc5c", "#88d8b0"];
            color[2] = ["#173f5f", "#20639b", "#3caea3", "#f6d55c", "#ed553b"];
            color[3] = ["#999", "#777", "#555", "#333", "#111"];
            color[4] = ["#ffa239", "#c8e6c9", "#81c784", "#4caf50", "#ffe789"];
            color[5] = ["#428", "#6ca2ea", "#b5d33d", "#fed23f", "#eb7d5b"];
            var rgb = color[s][seed];
            return rgb;
        };

        function random(minR, maxR) {
            var r = minR + (maxR - minR) * Math.random();
            return r
        };

        function rSeed(value) {
            var seed = Math.round(Math.random() * value);
            return seed
        };

        function dist(x1, y1, x2, y2) {
            var dx = Math.abs(x1 - x2);
            var dy = Math.abs(y1 - y2);
            var d = Math.max(dx, dy);
            return d
        }
    </script>

</body>

</html>