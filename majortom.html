<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="/javascripts/three.js"></script>
    <script src="/javascripts/objloader.js"></script>
</head>

<body>
    <script>
        var w = h = 1024;
        var canvas, ctx;
        var canvas2, ctx2;
        var canvas3, ctx3;
        var canvast, ctxt;
        var mesh, helmet;
        var time = 0;
        var pivot;
        var cylinder = [];
        var renderer, scene, camera;
        var cylinder2 = [];
        var cylinder3 = [];
        var string2 = "AGAIN";
        var wow;



        window.onload = function () {
            canvas = document.createElement("canvas");
            var w2 = 512;
            canvas.width = w2;
            canvas.height = w2;

            document.body.appendChild(canvas);
            ctx = canvas.getContext("2d");
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, w2, w2);
           
            init3d()

        }


        var drama={
            x:[],
            y:[],

        }





        function init3d() {


            scene = new THREE.Scene();
            //scene.background = canvas2;

            camera = new THREE.PerspectiveCamera(65, w / h, 0.01, 2000);
            camera.position.set(0, 0, 250);
            renderer = new THREE.WebGLRenderer({
                antialias: true,
                //alpha:true
            });


            var alight = new THREE.AmbientLight(0xcccccc, 1);
            scene.add(alight);

            var plight = new THREE.PointLight(0xFFAE9A, 0.8);
            scene.add(plight);
            plight.position.set(100, 100, 100);
            document.body.appendChild(renderer.domElement);
            renderer.setSize(w, h);

            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            plight.castShadow = true;

            plight.shadow.mapSize.width = 512; // default
            plight.shadow.mapSize.height = 512; // default
            plight.shadow.camera.near = 5; // default
            plight.shadow.camera.far = 500

            var loader = new THREE.OBJLoader();
            pivot = new THREE.Object3D();

            // var tex = new THREE.CanvasTexture(canvas)
            // tex.wrapS = THREE.RepeatWrapping;
            // tex.wrapT = THREE.RepeatWrapping;
            // tex.repeat.set(50, 50);

            // var envMap = new THREE.TextureLoader().load('/images/emap.png');
            // envMap.mapping = THREE.SphericalReflectionMapping;

            var tex = new THREE.CanvasTexture(canvas);


            loader.load(
                'obj/helmet.obj',
                function (obj) {
                    obj.traverse(
                        function (child) {
                            if (child.isMesh) {
                                mesh = child.geometry
                            }

                        }
                    );

                    var material = new THREE.MeshStandardMaterial({
                        side: THREE.DoubleSide,
                        //color:0x0E0A13,
                        //envMap: envMap,
                        roughness: 0,
                        map: tex,
                    })

                    helmet = new THREE.Mesh(mesh, material);
                    pivot.add(helmet);

                    // helmet.castShadow=true;
                    helmet.receiveShadow = true;

                    helmet.rotation.x = Math.PI / 40;
                    var size = 80;
                    helmet.scale.set(size, size, size);



                },
                function onprogress() {

                },
                function onerror() {

                }

            );



            scene.add(pivot);
            // pivot.rotation.z = Math.PI / 8;
            // pivot.rotation.y = Math.PI / 8;
            // pivot.scale.set(0.8,0.8,0.8);

            // function CustomSinCurve(scale) {
            //     THREE.Curve.call(this);
            //     this.scale = (scale === undefined) ? 1 : scale;
            // }

            // CustomSinCurve.prototype = Object.create(THREE.Curve.prototype);
            // CustomSinCurve.prototype.constructor = CustomSinCurve;

            // CustomSinCurve.prototype.getPoint = function (t) {
            //     var tx = Math.sin(2 * Math.PI * t);
            //     var ty = t*2;
            //     var tz = Math.cos(2 * Math.PI * t);
            //     return new THREE.Vector3(tx, ty, tz).multiplyScalar(this.scale);
            // };
            var path=new THREE.Curve();
            path.getPoint = function (t) {
                var tx = Math.sin(2 * Math.PI * t)*90;
                var ty = 0;
                var tz = Math.cos(2  * Math.PI * t)*90;
                return new THREE.Vector3(tx, ty, tz);
            };

            //var path = new CustomSinCurve(90);
            var geometry = new THREE.TubeGeometry(path, 200, 1, 5, false);
            var material = new THREE.MeshBasicMaterial({
                color: 0x00ff00
            });
            wow = new THREE.Mesh(geometry, material);
            scene.add(wow);
           // wow.scale.set(9,9,9);
            wow.position.y=-140;






            animate();

        }


        function animate() {



            pivot.rotation.y = Math.cos(time / 200) * 0.5;
            pivot.rotation.x = Math.cos(time / 100) * 0.1;
            renderer.render(scene, camera);

            requestAnimationFrame(animate);
            time++
        }
    </script>
</body>

</html>