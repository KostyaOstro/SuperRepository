<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<script>
    var ctx, drawingCanvas;
    var time = 0;
    var w, h;
    var point;
    var childs = 50;
    var line = [];
    var x = [];
    var y = [];
    var a = [];
    var timer = [];
    var trigger = [];
    var dd;
    var lines = 60;
    var r = 3;
    
    window.onload = function () {
        drawingCanvas = document.createElement('canvas');
        document.body.appendChild(drawingCanvas);
        ctx = drawingCanvas.getContext("2d");
        w = 1200;
        h = 1200;
        dd = w / 50;
        drawingCanvas.height = h;
        drawingCanvas.width = w;
        ctx.lineWidth=r;
        ctx.strokeStyle="#990000";
        point = {
            speed: 20,
            x: w / 2,
            y: h / 2,
            r: r,
            vx: Math.random() - 0.5,
            vy: Math.random() - 0.5,
            timer: Math.random() * 500 + 200,
            trigger: 0,
            color: rColor(),
            draw() {
                ctx.fillStyle = "black";
                if (this.trigger > this.timer) {
                    this.timer = Math.random() * 500 + 200;
                    this.trigger = 0;
                    this.vx = Math.random() - 0.5;
                    this.vy = Math.random() - 0.5;
                };
                ctx.beginPath();
                this.x += this.vx * this.speed;
                this.y += this.vy * this.speed;
                if (this.x > w || this.x < 0) {
                    this.vx = -this.vx
                }
                if (this.y > h || this.y < 0) {
                    this.vy = -this.vy
                }

                ctx.arc(this.x - this.r, this.y - this.r, this.r, 0, Math.PI * 2);

                ctx.closePath();
                ctx.fill();
                this.trigger++
            }

        }
        for (j = 0; j < lines; j++) {
            line[j] = {
                x: [],
                y: [],
                s: [],
            }
            for (var i = 0; i < childs; i++) {
                var seed = Math.round(Math.random() * 6);

                if (seed > 5) {
                    line[j].s[i] = 1;
                } else {
                    line[j].s[i] = 0;
                }
                line[j].x[i] = point.x;
                line[j].y[i] = point.y;
            }
        }
        animate();
    };



    function draw() {
        point.draw()
        
        for (j = 0; j < lines; j++) {
            ctx.beginPath
            ctx.moveTo(point.x, point.y);
            for (i = 0; i < childs; i++) {
                if (i == 0) {
                    var d = dist(point.x, point.y, line[j].x[i], line[j].y[i]);
                    if (d > dd*j) {

                        var angle = Math.atan2(point.y - line[j].y[i], point.x - line[j].x[i]);
                    
                        line[j].x[i] += Math.cos(angle)*(d-dd*j);
                        line[j].y[i] += Math.sin(angle)*(d-dd*j);

                    }
                } else {
                    var d = dist(line[j].x[i - 1], line[j].y[i - 1], line[j].x[i], line[j].y[i]);
                    if (d > dd) {
                        var angle = Math.atan2(line[j].y[i - 1] - line[j].y[i], line[j].x[i - 1] - line[j].x[i]);
                        angle += Math.cos(time / 50+i/childs*j/lines)*Math.PI/10;
                        line[j].x[i] += Math.cos(angle)*(d-dd);
                        line[j].y[i] += Math.sin(angle)*(d-dd);
                    }
                }

               
                ctx.lineTo(line[j].x[i], line[j].y[i]);
            
            }
            ctx.stroke()
        }
        
    }

    function dist(x, y, x1, y1) {
        var dx = x - x1;
        var dy = y - y1;
        var d = Math.sqrt(dx * dx + dy * dy);
        return d
    }

    function clearFrame() {
        ctx.fillStyle="#000033"
        ctx.fillRect(0, 0, w, h);
    }


    function animate() {
        clearFrame();
        draw();
        requestAnimationFrame(animate);
        time++
    }

    function rColor() {
        var seed = Math.round(Math.random() * 6);
        switch (seed) {
            case 1:
                var r = Math.round(Math.random() * 128) + 64;
                var g = Math.round(Math.random() * 128) + 64;
                var b = 0;
                break;
            case 2:
                var r = 0; // Math.round(Math.abs(Math.sin(Math.random()) * 128)) + 128;
                var g = Math.round(Math.random() * 128) + 64;
                var b = Math.round(Math.random() * 128) + 64;
            default:
                var r = Math.round(Math.random() * 128) + 64;
                var g = 0; //Math.round(Math.abs(Math.sin(Math.random()) * 128)) + 128;
                var b = Math.round(Math.random() * 128) + 64;
                break;
        }
        var rgb = "rgba(" + r + "," + g + "," + b + ",0.7)";
        return rgb;
    }
</script>

<body>

</body>

</html>