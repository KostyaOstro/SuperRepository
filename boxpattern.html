<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="/javascripts/myLib.js"></script>
    <script src="/javascripts/three.js"></script>
 
</head>
<script>
    var canvas = [];
    var ctx = [];
    var w = h = 1024;
    var mw = mh = 256;
    var time = 0;
    var scene, camera, renderer;
    var box = [];
    var pivot;
    var tex = [];
    var cop = 100;
    var fcanvas, fctx;
    var vy = [];
    var py = [];
    window.onload = function(){

        for(let i = 0; i < cop; i++){
            initCanvas(i);
           
        }
        
        fcanvas = document.createElement('canvas');
        fcanvas.height = h;
        fcanvas.width = w;
        document.body.appendChild(fcanvas);
        fctx = fcanvas.getContext("2d");
         
        function initCanvas(n){
            canvas[n] = document.createElement('canvas');
            canvas[n].height = mh;
            canvas[n].width = mw;
            //document.body.appendChild(canvas[n]);
            ctx[n] = canvas[n].getContext("2d");
            pattern.init();
            pattern.draw(n);
            tex[n] = new THREE.CanvasTexture(canvas[n]);
        }
        
        
       
        if(ctx){
            init3d()
        }
        

    }
    var pattern = {
        lines: rSeed(10) + 10,
        dash: [],
        height: [],
        margin: [],
        segments: 50,
        init (){
            for (let i = 0; i < this.lines; i++ ){
                if(rSeed(100) > 80){ 
                    this.dash[i] = 1;
                    this.margin[i] = 1
                }else{
                    this.dash[i] = rSeed(20) + 10;
                    this.margin[i] = random(.2, .8)
                }
              
               
                this.height[i] = rSeed(mh / this.lines) / 2 ;  
            }
        },
        draw(n){
            ctx[n].fillStyle = "black";
            ctx[n].fillRect(0, 0, w, h);
            ctx[n].fillStyle = "white";
            for (let i = 0; i < this.lines; i++ ){
                let ww = mw / this.dash[i] * this.margin[i];
                let hh = this.height[i];
                for (let j = 0; j < this.dash[i]; j++ ){
                    let x = mw / this.dash[i] * j;
                    let y = i * mh / this.lines;
                    ctx[n].fillRect(
                        x,
                        y,
                        ww,
                        hh
                    )
                    
                }   
            }
        }



    };
    function init3d(){
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(10, w / h, .01, 2000);
        camera.position.set(0, 0, 1000);
        renderer = new THREE.WebGLRenderer({
            logarithmicDepthBuffer: true
        });
        renderer.setSize(w, h);
        //document.body.appendChild(renderer.domElement);
        renderer.shadowMap.enabled = true;

        var alight = new THREE.AmbientLight(new THREE.Color('blue'), .4);
        scene.add(alight);

        
        var plight = new THREE.PointLight(new THREE.Color('white'), 2);
        scene.add(plight);
        plight.position.set(100, 100, 100);
        plight.castShadow = true;
        plight.shadow.mapSize.x = 1024;
        plight.shadow.mapSize.y = 1024;


        pivot = new THREE.Object3D();
        
        for (let i = 0; i < cop; i++){
            
            var s = random(.1, rSeed());
            var geometry = new THREE.BoxGeometry(s, s, s, 1, 1, 1);
            var material = new THREE.MeshStandardMaterial({
                roughness: 0,
                map : tex[i]
            });
            box[i] = new THREE.Mesh(geometry, material);
            let x = random(-50 + s/2, 50 - s/2);
            let y = random(-50 + s/2, 50 - s/2);
            let z = random(-50 + s/2, 50 - s/2);
            box[i].position.set(x, y, z);

            let rx = rSeed(4) * Math.PI / 2;
            let ry = rSeed(4) * Math.PI / 2;
            let rz = rSeed(4) * Math.PI / 2;

            box[i].rotation.set(rx, ry, rz);
            pivot.add(box[i]);
            box[i].castShadow = true;
            box[i].receiveShadow = true;
            box[i].type = rSeed(2);
            box[i].speed = random(-1 , 1);
        }
        scene.add(pivot);

        animate()
    };
    function animate(){
        pivot.rotation.y += .01;
        for (let i = 0; i < cop; i++){
          
            switch(box[i].type){
                case 0:
                    box[i].position.x += box[i].speed;
                break;
                case 1:
                    box[i].position.y += box[i].speed;
                break;
                default:
                    box[i].position.z += box[i].speed;
                break;
            }
            if(box[i].position.x > 50 || box[i].position.x < -50){
                box[i].speed *= -1;
            }
            if(box[i].position.y > 50 || box[i].position.y < -50){
                box[i].speed *= -1;
            }
            if(box[i].position.z > 50 || box[i].position.z < -50){
                box[i].speed *= -1;
            }
        }
        renderer.render(scene, camera);
        fctx.drawImage(renderer.domElement, 0, 0);
        var fs = h / 30;
        var lh = 1;
        var string = 'RATIONALITY';
        fctx.texAlign = "center";
        fctx.fillStyle = "white";
        fctx.strokeStyle = "white";
        fctx.font = 'bold ' + fs + 'px arial';
     
        for (let i = 0; i < string.length; i++){
            if (time == 0){
                vy[i] = random(-.5, .5);
                py[i] = h / 2 - fs / 2 * lh ;
               
            }
            let x = w / (string.length ) * (i + .4) * 0.8 + 0.1 * w ;
            py[i] += vy[i];
            if (py[i] > 0.6 * h || py[i] < 0.4 * h){
                vy[i] *= -1;
            }
            fctx.fillText(
                string[i],
                x - fs / 3,
                py[i],
            )
            fctx.beginPath();
            fctx.moveTo(
                x,
                0.4 * h
            )
            fctx.lineTo(
                x,
                0.6 * h
            )
            fctx.stroke()
        }
        requestAnimationFrame(animate);
        time ++;
    }
</script>
<body>
    
</body>
</html>