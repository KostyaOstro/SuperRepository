<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css?family=Bungee" rel="stylesheet">
</head>

<style>
    * {
        margin: 0px;
        padding: 0px;
        font-family: 'Bungee';
    }
</style>
<script>
    var text, pctx, image, data, canvas, canvas2, lctx, finalctx;
    var w = 100;
    var h = 100;
    var xScale = 10;
    var time = 0;
    var pixel = [];
    var pointes = [];
    window.onload = function () {
        canvas = document.createElement('canvas');
        canvas.width = w;
        canvas.height = h;
        //document.body.appendChild(canvas);
        text = canvas.getContext("2d");
        text.beginPath();
        text.rect(0, 0, w, h);
        text.stroke();


        canvas2 = document.createElement('canvas');
        canvas2.width = w * xScale;
        canvas2.height = h * xScale;
        //document.body.appendChild(canvas2);
        pctx = canvas2.getContext("2d");

        canvas4 = document.createElement('canvas');
        canvas4.width = w * xScale;
        canvas4.height = h * xScale;
        document.body.appendChild(canvas4);
        finalctx = canvas4.getContext("2d");
        text.fillStyle = 'white';
        text.fillRect(0, 0, w, h);
       
        // for (var ii = 0; ii < 20; ii++) {
        //     text.fillStyle = "Black";
        //     var x = Math.random() * w;
        //     var y = Math.random() * h;
        //     text.beginPath();
        //     text.arc(x, y,Math.random()* w / 40, 0, Math.PI * 2);
        //     text.closePath();
        //     text.fill();
        // }
        text.fillStyle = "Black";
        var fontSize = 25;
        var lineHeight = fontSize*1.2;
        text.font = fontSize + "px Bungee";

        text.fillText("LOVE", 12, lineHeight*2 );
        // text.fillText("_LOVE", 12, lineHeight * 2);
        // text.fillText("NEON_", 12, lineHeight * 3);
        pctx.strokeStyle = 'white';
        pctx.lineWidth = 0.8;


        image = text.getImageData(0, 0, w, h);
        data = image.data;
        for (i = 0; i < h; i++) {
            for (j = 0; j < w; j++) {
                var index = j * 4 + i * 4 * w;
                var value = data[index];
                if (value <= 196) {
                    var x = j * xScale;
                    var y = i * xScale;
                    var Ipoint = {
                        x: x,
                        y: y,
                        r: Math.random() * xScale / 2 + xScale / 2
                    };
                    pointes.push(Ipoint)
                }

            }

        }

        animate();
    }
    var tp = 50;
    var triggerPoint = [];
    for (i = 0; i < tp; i++) {
        var point = {
            speed: 3,
            x: Math.random() * w * xScale,
            y: Math.random() * h * xScale,
            r: Math.random()*3+1,
            vx: Math.random() - 0.5,
            vy: Math.random() - 0.5,
            timer: Math.random() * 500 + 200,
            trigger: 0,
            color: rColor(),


            draw() {
                if (this.trigger > this.timer) {
                    this.timer = Math.random() * 500 + 200;
                    this.trigger = 0;
                    this.vx = Math.random() - 0.5;
                    this.vy = Math.random() - 0.5;

                };
                pctx.beginPath();
                this.x += this.vx * this.speed;
                this.y += this.vy * this.speed;
                if (this.x > w * xScale || this.x < 0) {
                    this.vx = -this.vx
                }
                if (this.y > h * xScale || this.y < 0) {
                    this.vy = -this.vy
                }
                pctx.arc(this.x-this.r, this.y-this.r, this.r, 0, Math.PI * 2);
                pctx.closePath();
                pctx.fill()
                this.trigger++
            }
        }
        triggerPoint.push(point);
    }

    function draw() {
        pctx.fillStyle = 'white';

        for (i = 0; i < tp; i++) {
            triggerPoint[i].draw();
        }

        for (i = 0; i < pointes.length; i++) {
            var x = pointes[i].x + xScale / 2 + Math.cos(i / pointes.length * 2 + time / 50) * 10;
            var y = pointes[i].y + xScale / 2 + Math.sin(i / pointes.length * 2 + time / 50) * 10;

            var d = [];
            var min = 0;
            for (j = 0; j < tp; j++) {
                d[j] = dist(x, y, triggerPoint[j].x, triggerPoint[j].y);
                if (d[j] < d[min]) {
                    min = j
                }
            }
            var obj = triggerPoint[min];
            finalctx.strokeStyle = obj.color;

            // if (d < w / 4*xScale) {
            finalctx.beginPath();
            finalctx.moveTo(x, y);
            // d[min]=(d[min]>w/4*xScale)?w/4*xScale:d;
            var length = d[min];
            var angle = Math.atan2(obj.y - y, obj.x - x);
            var x2 = x + Math.cos(angle) * length;
            var y2 = y + Math.sin(angle) * length;
            finalctx.lineTo(x2, y2);
            finalctx.stroke();
            // }
            pctx.beginPath();
            var r = pointes[i].r / 4 * Math.abs(Math.cos(i / pointes.length + time / 50)) + pointes[i].r / 4;
            pctx.arc(x, y, r, 0, Math.PI * 2);
            pctx.closePath();


            pctx.fill();
            // pctx.strokeStyle = 'black';
            // pctx.stroke();
        }

        //finalctx.drawImage(canvas3,0,0,w*xScale,h*xScale);
        finalctx.drawImage(canvas2, 0, 0, w * xScale, h * xScale);

    }

    function dist(x, y, x1, y1) {
        var dx = x - x1;
        var dy = y - y1;
        var d = Math.sqrt(dx * dx + dy * dy);
        return d
    }

    function animate() {
        clear();
        draw();
        window.requestAnimationFrame(animate);
        time++
    }

    function clear() {
        // pctx.fillStyle='black';
        pctx.clearRect(0, 0, w * xScale, h * xScale);

        finalctx.fillRect(0, 0, w * xScale, h * xScale)
        //pctx.clearRect(0, 0, w * xScale, h * xScale)
    }

    function rColor() {
        var seed = Math.round(Math.random() * 6);
        switch (seed) {
            case 1:
                var r = Math.round(Math.random() * 128) + 128;
                var g = Math.round(Math.random() * 128) + 128;
                var b = 0;
                break;
            case 2:
                var r = 0; // Math.round(Math.abs(Math.sin(Math.random()) * 128)) + 128;
                var g = Math.round(Math.random() * 128) + 128;
                var b = Math.round(Math.random() * 128) + 128;
            default:
                var r = Math.round(Math.random() * 128) + 128;
                var g = 0; //Math.round(Math.abs(Math.sin(Math.random()) * 128)) + 128;
                var b = Math.round(Math.random() * 128) + 128;
                break;
        }
        var rgb = "rgba(" + r + "," + g + "," + b + ",0.5)";
        return rgb;
    }
</script>

<body>
    sc
</body>

</html>