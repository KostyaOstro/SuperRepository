<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            padding: 0px;
            margin: 0px
        }
    </style>

</head>
<script src="javascripts/three.js"></script>
<script src="javascripts/orbitcontrols.js"></script>

<body>
    <script>
        var w = window.innerWidth;
        var h = window.innerHeight;
        var time = 0;
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(65, w / h, 0.01, 2000);
        camera.position.z = 100;

        var renderer = new THREE.WebGLRenderer({
            // antialias: true
        });
        renderer.setSize(w, h);

        //light.position.set(-50,-100,100);
        document.body.appendChild(renderer.domElement);


        var copies = 20;
        var maxRadius = 30;
        var minRadius = 20;
        var segment = [];

        var lmaterial = new THREE.LineBasicMaterial({
            // color:THREE.VertexColors
        });

        var g = [];
        var fx = [];
        var maxSize = 50;
        var minSize = 30;
        for (i = 1; i < 4; i++) {
            g[i] = new THREE.IcosahedronGeometry(maxSize, i + 1);
            fx[i] = g[i].faces.length - 1;
        }
        var pivot = [];

        var mat = [];
        var dmemory = 0;
        var instances = 10;
        var wg = [];
        var figure = [];
        for (l = 0; l < instances; l++) {
            var v = 0;
            wg[l] = new THREE.Geometry();

            var wseed = Math.round(Math.random() * 4);

            if (wseed > 2 && dmemory == 0 && l!=0) {
                
                switch (mat[l - 1]) {
                    case 2:
                        var m2 = new THREE.PointsMaterial({
                            color: rColor(),
                            size: 1,
                        });
                        figure[l] = new THREE.Points(wg[l - 1], m2);
                        break;
                    case 3:
                        var m2 = new THREE.MeshBasicMaterial({
                            color: rColor(),
                            side: THREE.DoubleSide,
                            wireframe: true,
                            wireframeLinewidth: 500,
                        });
                        figure[l] = new THREE.Mesh(wg[l - 1], m2);
                    case 0:
                        var m2 = new THREE.LineBasicMaterial({
                            color: rColor(),
                            //side: THREE.DoubleSide,
                        });
                        figure[l] = new THREE.Line(wg[l - 1], m2);
                        break;
                }
                console.log("l=",l,"dmemory=",dmemory,'scale=',figure[l-1].scale.x);
                var meshSize = figure[l-1].scale.x;
                figure[l].scale.set(meshSize, meshSize, meshSize);
                figure[l].rotation.x = figure[l - 1].rotation.x;
                figure[l].rotation.y = figure[l - 1].rotation.y;
                figure[l].rotation.z = figure[l - 1].rotation.z;
                dmemory = 1;
            } else { //
                var seed2 = Math.round(Math.random() * 4); //choose topology 
                switch (seed2) {
                    case 1:
                        gseed = 1;
                        break;
                    case 2:
                        gseed = 3;
                        break;
                    case 4:
                        gseed = 4;
                        break;
                    default:
                        gseed = 2;
                        break;
                }
                for (var i = 0; i < fx[gseed] / 5; i++) { //get  vertices data
                    var r = Math.round(Math.random() * fx[gseed] / 5);
                    var p = [];
                    p[0] = g[gseed].faces[r].a;
                    p[1] = g[gseed].faces[r].b;
                    p[2] = g[gseed].faces[r].c;
                    for (var j = 0; j < 3; j++) {
                        var x = g[gseed].vertices[p[j]].x;
                        var y = g[gseed].vertices[p[j]].y;
                        var z = g[gseed].vertices[p[j]].z;
                        wg[l].vertices.push(new THREE.Vector3(x, y, z))
                    }
                    v = wg[l].vertices.length - 1;
                    wg[l].faces.push(new THREE.Face3(v - 2, v - 1, v));
                }

                var seed3 = Math.round(Math.random() * 4); //choose material
                switch (seed3) {
                    case 2:
                        var m2 = new THREE.MeshBasicMaterial({
                            color: rColor(),
                            side: THREE.DoubleSide,
                            wireframe: true,
                            wireframeLinewidth: 500,

                        });
                        figure[l] = new THREE.Mesh(wg[l], m2);
                        mat[l] = 2;
                        break;
                    case 3:
                        var m2 = new THREE.PointsMaterial({
                            color: rColor(),
                            size: 1,
                        });
                        figure[l] = new THREE.Points(wg[l], m2);
                        mat[l] = 3;
                        break;
                    default:
                        var m2 = new THREE.MeshBasicMaterial({
                            color: rColor(),
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.9

                        });
                        figure[l] = new THREE.Mesh(wg[l], m2);
                        mat[l] = 0;
                        break;

                }
                pivot.push(new THREE.Object3D());
                
                var meshSize = ((maxSize - minSize) / maxSize) / instances * l + minSize / maxSize;
                figure[l].scale.set(meshSize, meshSize, meshSize);
                
                figure[l].rotation.x = Math.random() * Math.PI * 2;
                figure[l].rotation.y = Math.random() * Math.PI * 2;
                figure[l].rotation.z = Math.random() * Math.PI * 2;
                dmemory = 0;
            }
            pivot[pivot.length - 1].add(figure[l]);
            
        }
        for(i=0;i<pivot.length;i++){
            scene.add(pivot[i])
        }
        var m = new THREE.MeshBasicMaterial({
            color: rColor2(),

        });
        var mp = new THREE.PointsMaterial({
            color: "white",

        });
        var cg = new THREE.IcosahedronGeometry(20, 2);
        var centr = new THREE.Mesh(cg, m);
        scene.add(centr);
        var centrp = new THREE.Points(cg, mp);
        scene.add(centrp);
        animate();

        function animate() {

            for (var l = 0; l < pivot.length; l++) {
                pivot[l].rotation.x = time * 0.01 + l * 0.5;
                pivot[l].rotation.y = time * 0.01 + l * 0.5;

            }

            for (var j = 0; j < cg.vertices.length; j++) {
                cg.verticesNeedUpdate = true;
                cg.vertices[j].x += Math.sin(time / 50 + j / 20) * 0.05;
                cg.vertices[j].y += Math.sin(time / 50 + j / 20) * 0.05;
                cg.vertices[j].z += Math.sin(time / 50 + j / 20) * 0.05;
            }
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
            time++
        }

        function rColor() {
            var rseed = Math.round(Math.random() * 4);
            switch (rseed) {
                /*case 2:
                    var rgb = 'white'
                    break;*/
                case 3:
                    var r = Math.round(Math.random() * 256);
                    var g = 0 //Math.round(Math.random() * 128) + 128;
                    var b = Math.round(Math.random() * 256);
                    var rgb = "rgb(" + r + "," + g + "," + b + ")";
                    break;
                default:
                    var r = 0; //Math.round(Math.random()*128)+128;
                    var g = Math.round(Math.random() * 256);
                    var b = Math.round(Math.random() * 256);
                    var rgb = "rgb(" + r + "," + g + "," + b + ")";
                    break;
            }
            return rgb
        }

        function rColor2() {
            var rseed = Math.round(Math.random() * 4);
            if (rseed > 2) {
                var r = Math.round(Math.random() * 256);
                var g = 0 //Math.round(Math.random() * 128) + 128;
                var b = r;
                var rgb = "rgb(" + r + "," + g + "," + b + ")";
            } else {

                var r = 0; //Math.round(Math.random()*128)+128;
                var g = Math.round(Math.random() * 256);
                var b = g;
                var rgb = "rgb(" + r + "," + g + "," + b + ")";
            }

            return rgb
        }
    </script>

</body>

</html>